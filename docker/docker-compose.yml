# AviationWX Bridge - Docker Compose Configuration
# https://github.com/alexwitherspoon/aviationwx-bridge

services:
  bridge:
    build:
      context: ..
      dockerfile: docker/Dockerfile
      args:
        - GIT_COMMIT=${GIT_COMMIT:-dev}
    container_name: aviationwx-bridge
    restart: unless-stopped
    ports:
      - "1229:1229"  # Web console
    volumes:
      - ./data:/data  # Persistent config and data
    tmpfs:
      # RAM-based image queue (default: 200MB)
      # Adjust based on camera count and resolution:
      #   1-2 cameras @ 1080p: 100m is sufficient
      #   3-4 cameras @ 1080p: 200m recommended
      #   4 cameras @ 4K: 300m or higher
      # See DEPLOYMENT.md for sizing guidance
      - /dev/shm:size=${AVIATIONWX_TMPFS_SIZE:-200m}
    environment:
      - AVIATIONWX_CONFIG=/data/config.json
      - AVIATIONWX_QUEUE_PATH=/dev/shm/aviationwx
      # exiftool is used for EXIF reading/writing (included in Docker image)
    # Uncomment for production hardening:
    # security_opt:
    #   - no-new-privileges:true
    # cap_drop:
    #   - ALL
    # read_only: true
